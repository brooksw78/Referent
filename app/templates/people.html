{% extends "base.html" %}

{% block content %}
<h2>People</h2>

<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-3">
  <form method="GET" class="d-flex gap-2 flex-grow-1" role="search">
    <input type="text" class="form-control" name="q" placeholder="Search people..." value="{{ search_query or '' }}">
    <button type="submit" class="btn btn-outline-primary">Search</button>
    {% if search_query %}
    <a href="{{ url_for('main.people') }}" class="btn btn-outline-secondary">Clear</a>
    {% endif %}
  </form>
  <a href="{{ url_for('main.add_person') }}" class="btn btn-success">Add Person</a>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th class="text-center">Epigraphs</th>
      <th class="text-center">Referents</th>
      <th>Born</th>
      <th>Died</th>
      <th>&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    {% for person in people %}
    <tr>
     <td>
        <div class="mt-1">
            <strong><a href="{{ url_for('main.view_person', person_id=person[0]) }}">{{ person[1] }}</a></strong>
            {% if person[10] %}
            <div class="text-muted small">{{ person[10] }}</div>
            {% endif %}
        </div>
      </td>
      <td>{{ person[2] or '—' }}</td>
      <td class="text-center">
        {% if person[5] %}
          <a href="{{ url_for('main.view_person', person_id=person[0]) }}" class="text-decoration-none">
            <span class="badge bg-info rounded-pill">{{ person[5] }}</span>
          </a>
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </td>
      <td align="center">
        {% if person[4] %}
          <a href="{{ url_for('main.view_person', person_id=person[0]) }}" class="text-decoration-none">
            <span class="badge bg-primary rounded-pill"><strong>{{ person[4] }}</strong></span>
          </a>
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </td>
      <td>
        {% if person[6] %}
          {{ person[6] }}{% if person[8] == 'BC' %} BC{% endif %}
        {% else %}
          —
        {% endif %}
      </td>
      <td>
        {% if person[7] %}
          {{ person[7] }}{% if person[9] == 'BC' %} BC{% endif %}
        {% else %}
          —
        {% endif %}
      </td>
      <td align="right">
        <div class="mt-1">
            <a href="{{ url_for('main.view_person', person_id=person[0]) }}" class="btn btn-sm btn-outline-primary">View</a>
            <a href="{{ url_for('main.edit_person', person_id=person[0]) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
            &nbsp;
            <form action="{{ url_for('main.delete_person', person_id=person[0]) }}" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this person?')">Delete</button>
            </form>
        </div>
        </td>
    </tr>
    {% endfor %}
    {% if not people %}
    <tr>
      <td colspan="7" class="text-center text-muted">No people found.</td>
    </tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
