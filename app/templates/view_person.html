{% extends "base.html" %}

{% block content %}
<h2 class="d-flex justify-content-between align-items-center">
  <span>
    {{ person[1] }}
    {% if person[5] or person[6] or age_label %}
    <small class="d-block text-muted">
      {% if person[5] and person[6] %}
        {{ person[5] }}{% if birth_year_era == 'BC' %} BC{% endif %} – {{ person[6] }}{% if death_year_era == 'BC' %} BC{% endif %}
        {% if age_label %} · {{ age_label }}{% endif %}
      {% else %}
        {% if person[5] %}
          Born {{ person[5] }}{% if birth_year_era == 'BC' %} BC{% endif %}
        {% endif %}
        {% if person[6] %}
          {% if person[5] %} · {% endif %}Died {{ person[6] }}{% if death_year_era == 'BC' %} BC{% endif %}
        {% endif %}
        {% if age_label %}
          {% if person[5] or person[6] %} · {% endif %}{{ age_label }}
        {% endif %}
        {% if not person[5] and not person[6] and (birth_year_era == 'BC' or death_year_era == 'BC') %}
          BC
        {% endif %}
      {% endif %}
    </small>
    {% endif %}
  </span>
  <div class="d-flex gap-2">
    <a href="{{ url_for('main.edit_person', person_id=person[0]) }}" class="btn btn-outline-primary">Edit</a>
    <a href="{{ url_for('main.people') }}" class="btn btn-outline-primary">Back to People</a>
  </div>
</h2>

<div class="row mb-4">
  <div class="col-md-6">
    <ul class="list-group list-group-flush">
      {% if person[8] %}
      <li class="list-group-item"><strong>Type:</strong> {{ person[8] }}</li>
      {% endif %}
      {% if person[10] %}
      <li class="list-group-item"><strong>Nationality:</strong> {{ person[10] }}</li>
      {% endif %}
      {% if person[3] %}
      <li class="list-group-item"><strong>Wikipedia:</strong> <a href="{{ person[3] }}" target="_blank" rel="noreferrer">{{ person[3] }}</a></li>
      {% endif %}
    </ul>
  </div>
  <div class="col-md-6">
    {% if person[4] %}
    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Summary</span>
        <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#person-summary" aria-expanded="false" aria-controls="person-summary">
          View Full
        </button>
      </div>
      <div class="card-body">
        <p class="card-text" style="white-space: pre-wrap;">
          {{ person[4][:240] }}{% if person[4]|length > 240 %}…{% endif %}
        </p>
        <div class="collapse" id="person-summary">
          <div class="mt-3" style="white-space: pre-wrap;">{{ person[4] }}</div>
        </div>
      </div>
    </div>
    {% endif %}
    {% if person[7] %}
    <div class="card">
      <div class="card-header">Notes</div>
      <div class="card-body">
        <p class="card-text" style="white-space: pre-wrap;">{{ person[7] }}</p>
      </div>
    </div>
    {% endif %}
  </div>
</div>

{% set authored_books = contributions.get('author', []) %}
{% if authored_books %}
<h4>Authored Books</h4>
<ul class="list-group mb-4">
  {% for contribution in authored_books %}
  <li class="list-group-item">
    <a href="{{ url_for('main.view_book', book_id=contribution[0]) }}">{{ contribution[1] }}</a>
  </li>
  {% endfor %}
</ul>
{% endif %}

{% set translated_books = contributions.get('translator', []) %}
{% if translated_books %}
<h4>Translated Books</h4>
<ul class="list-group mb-4">
  {% for contribution in translated_books %}
  <li class="list-group-item">
    <a href="{{ url_for('main.view_book', book_id=contribution[0]) }}">{{ contribution[1] }}</a>
  </li>
  {% endfor %}
</ul>
{% endif %}

<h4>Epigraphs</h4>
{% if epigraphs %}
<ul class="list-group mb-4">
  {% for epigraph in epigraphs %}
  <li class="list-group-item">
    <div class="d-flex justify-content-between align-items-start">
      <div class="me-3 flex-grow-1">
        <div class="mb-2"><strong>From:</strong> <a href="{{ url_for('main.view_book', book_id=epigraph[4]) }}"><em>{{ epigraph[3] }}</em></a></div>
        <div class="p-3 bg-light border rounded" style="white-space: pre-wrap;">{{ epigraph[1] }}</div>
        {% if epigraph[2] %}
        <div class="mt-2">
          <button class="btn btn-sm btn-link p-0" data-bs-toggle="collapse" data-bs-target="#epigraph-note-{{ epigraph[0] }}">
            <i class="bi bi-chat-left-text"></i> Notes
          </button>
          <div class="collapse mt-2" id="epigraph-note-{{ epigraph[0] }}">
            <div class="card card-body bg-light" style="white-space: pre-wrap;">{{ epigraph[2] }}</div>
          </div>
        </div>
        {% endif %}
      </div>
      <div class="text-end small text-muted">
        {% if epigraph[5] %}Added {{ epigraph[5] }}{% endif %}
      </div>
    </div>
  </li>
  {% endfor %}
</ul>
{% else %}
<p class="text-muted">No epigraphs recorded for this person.</p>
{% endif %}

<h4>Citations</h4>
{% if citations %}
<ul class="list-group">
  {% for citation in citations %}
  <li class="list-group-item d-flex justify-content-between align-items-start">
    <div class="me-3 flex-grow-1">
      <div>
        Cited in <a href="{{ url_for('main.view_book', book_id=citation[4]) }}"><em>{{ citation[2] }}</em></a> on page {{ citation[3] }}
        {% if citation[6] %}
        <i class="bi bi-journal-minus ms-2 text-info" title="Indirect citation"></i>
        {% endif %}
      </div>
      {% if citation[5] %}
      <div class="mt-2">
        <button class="btn btn-sm btn-link p-0" data-bs-toggle="collapse" data-bs-target="#citation-note-{{ citation[0] }}">
          <i class="bi bi-chat-left-text"></i> Notes
        </button>
        <div class="collapse mt-2" id="citation-note-{{ citation[0] }}">
          <div class="card card-body text-bg-info" style="white-space: pre-wrap;">{{ citation[5] }}</div>
        </div>
      </div>
      {% endif %}
    </div>
    <a href="{{ url_for('main.edit_citation', citation_id=citation[0]) }}" class="btn btn-sm btn-outline-secondary">Edit Citation</a>
  </li>
  {% endfor %}
</ul>
{% else %}
<p class="text-muted">No citations recorded for this person.</p>
{% endif %}
{% endblock %}
